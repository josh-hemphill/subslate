!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).subslate=t.subslate||{})}(this,(function(t){"use strict";function e(t,e,o){return{[Symbol.iterator]:()=>({next(){const n=t(...e);return n?{done:!1,value:n}:(o&&o(),{done:!0,value:void 0})}})}}const o=t=>Array.isArray(t)&&t.length>0,n=t=>o(t)&&2===t.length&&t.every((t=>"string"==typeof t)),r=(t,e,r="Missing Provided Input")=>{if(void 0===t)return[e];if("string"==typeof t)return[[t,t]];if(n(t))return[t];if((t=>o(t)&&t.every((t=>n(t))))(t))return t;throw Error(r)};function s(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}const a=Symbol("Blank Value");class i{constructor(t){this.context=t}getContextVal(t,e,o){const n=t.content,r=this.context,{allowRootBracket:i,allowUnquotedProps:l,sanitizer:c}=o,{per:p,opBrac:f,clBrac:u,quote:d,apos:g,backt:m}=e,h=[d,g,m].flat().filter((t=>n.includes(t))).map((t=>s(t)));function b(t,e,o=0){let r=a,c=0;const d=Object.keys(e);t:{if(0===o)for(const n of d)if(t.startsWith(n,o)){r=e[n],c=n.length;break t}if(0!==o)for(const n of p)if(t.startsWith(n,o))for(const s of d)if(t.startsWith(n+s,o)){r=e[s],c=n.length+s.length;break t}if(0!==o||i){const a=f.map(((t,e)=>[t,u[e]])).filter((e=>t.includes(e[0])&&t.includes(e[1])));let i=null;for(const[e,n]of a)if(t.startsWith(e,o)){i=[e,n];break}if(null===i)break t;const[p,g]=i.map((t=>s(t)));for(const t of[...h,...l?[""]:[]])for(const a of d){const i=s(a),l=RegExp(`^[\\s\\S]{${o}}(${p}s*${t}(${i})${t}s*${g})`);l.lastIndex=o;const f=l.exec(n);if(f&&f[2]){r=e[a],c=f[1].length;break t}}}}return[r,c]}let y=a,x=0;for(;x<n.length;){const t=y===a?r:y;if("object"!=typeof t)break;const[e,o]=b(n,t,x);if(0===o)break;x+=o,y=e}if(y=c(y===a?{isEmpty:!0,id:n,at:x}:{isEmpty:!1,value:y,id:n}),"string"!=typeof y)throw Error("Sanitizer did not provide string");return y}}const l={"'":"'",'"':'"',"\\":"\\","`":"`","[":"[","]":"]"},c=t=>l[t]||t,p={".":["&period;"],"\\":["&#x27;"],"'":["&apos;"],'"':["&quot;"],"[":["&lsqb;"],"]":["&rsqb;"]},f=t=>`\\u${Number.prototype.toString.call(t,16).toUpperCase()}`,u=t=>`&#x${Number.prototype.toString.call(t,16).toUpperCase()};`,d=(t,e)=>[...t].map((t=>t.split("").map((t=>({js:f,html:u}[e](String.prototype.charCodeAt.call(t,0))))).join(""))).join(""),g={url:t=>[encodeURIComponent(t)],html:t=>[[...t].map((t=>d(t,"html"))).join(""),[...t].map((t=>(t=>p[t]||t)(t))).join("")],js:t=>[[...t].map((t=>c(t))).join(""),[...t].map((t=>d(t,"js"))).join("")],json:t=>[[...t].map((t=>c(t))).join(""),[...t].map((t=>d(t,"js"))).join("")]},m=(t,e)=>{const o=new Set;for(let n in e)g[n]&&g[n](t).forEach((t=>o.add(t)));return Array.from(o)},h=t=>({startStopPairs:r(t.startStopPairs,["${","}"],"Invalid startStopPairs"),escapeSep:t.escapeSep,allowUnquotedProps:!!t.allowUnquotedProps,allowRootBracket:!!t.allowRootBracket,sanitizer:t.sanitizer||(t=>!0===t.isEmpty?"undefined":String(t.value)),maxNameLength:t.maxNameLength||256}),b=m,y=t=>{const[e,o,n,r,s,a]=[".","[","]",'"',"'","`"].map((e=>t?m(e,t):[e]));return{per:e,opBrac:o,clBrac:n,quote:r,apos:s,backt:a}},x=(t,o,n)=>{const r=h(n),{startStopPairs:a,escapeSep:l,maxNameLength:c}=r,p=a.filter((e=>t.includes(e[0])&&t.includes(e[1]))).map((t=>[s(t[0]),s(t[1])])),f=new Map;for(const[o,n]of p){const r=RegExp(`${o}s*([\\s\\S]{0,${c}}?)s*${n}`,"g"),s=()=>{r.lastIndex=0},a=()=>r.exec(t);for(const{index:t,0:o,1:n}of e(a,[],s))if(f.has(o)){f.get(o).indexes.push(t)}else f.set(o,{content:n,indexes:[t]})}const u=new i(o);let d=0;const g=[...t],m=y(l);for(const[t,e]of f){e.hasOwnProperty("value")||(e.value=u.getContextVal(e,m,r));for(const o of e.indexes)g.splice(o+d,t.length,...e.value),d+=e.value.length-t.length}return g.join("")};t.createEscapes=b,t.default=x,t.getDefaultOptions=h,t.getSeparators=y,t.subslate=x,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=subslate.poly.js.map
