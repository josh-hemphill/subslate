"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=t=>Array.isArray(t)&&t.length>0,e=e=>t(e)&&2===e.length&&e.every((t=>"string"==typeof t)),o=(o,r,n="Missing Provided Input")=>{if(void 0===o)return[r];if("string"==typeof o)return[[o,o]];if(e(o))return[o];if((o=>t(o)&&o.every((t=>e(t))))(o))return o;throw Error(n)};function r(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}const n=t=>!!t&&"object"==typeof t&&null!==t&&Object.keys(t).every((t=>"symbol"!=typeof t));function s(t,e){return Object.prototype.hasOwnProperty.call(t,e)}const a=Symbol("Blank Value");class i{constructor(t){this.context=t}getContextVal(t,e,o){const s=t.content,i=this.context,{allowRootBracket:l,allowUnquotedProps:c,sanitizer:p}=o,{per:f,opBracket:u,clBracket:d,quote:g,apostrophe:h,backtick:m}=e,y=[g,h,m].flat().filter((t=>s?.includes(t))).map((t=>r(t)));function x(t,e,o=0){let n=a,i=0;const p=Object.keys(e);t:{if(0===o)for(const r of p)if(t.startsWith(r,o)){n=e[r],i=r.length;break t}if(0!==o)for(const r of f)if(t.startsWith(r,o))for(const s of p)if(t.startsWith(r+s,o)){n=e[s],i=r.length+s.length;break t}if(0!==o||l){const a=u.map(((t,e)=>[t,d[e]])).filter((e=>t.includes(e[0])&&t.includes(e[1])));let l=null;for(const[e,r]of a)if(t.startsWith(e,o)){l=[e,r];break}if(null===l)break t;const[f,g]=l.map((t=>r(t)));for(const t of[...y,...c?[""]:[]])for(const a of p){const l=r(a),c=RegExp(`^[\\s\\S]{${o}}(${f}\\s*${t}(${l})${t}\\s*${g})`);c.lastIndex=o;const p=c.exec(s);if(p&&p[2]){n=e[a],i=p[1].length;break t}}}}return[n,i]}let b=a,j=0;for(;s?.length>j;){const t=b===a?i:b;if(!n(t))break;const[e,o]=x(s,t,j);if(0===o)break;j+=o,b=e}if(b=p(b===a?{isEmpty:!0,id:s,at:j}:{isEmpty:!1,value:b,id:s}),"string"!=typeof b)throw Error("Sanitizer did not provide string");return b}}const l={"'":"'",'"':'"',"\\":"\\","`":"`","[":"[","]":"]"},c=t=>s(l,t)?l[t]:t,p={".":["&period;"],"\\":["&#x27;"],"'":["&apos;"],'"':["&quot;"],"[":["&lsqb;"],"]":["&rsqb;"]},f=t=>`\\u${Number.prototype.toString.call(t,16).toUpperCase()}`,u=t=>`&#x${Number.prototype.toString.call(t,16).toUpperCase()};`,d=(t,e)=>[...t].map((t=>t.split("").map((t=>({js:f,html:u}[e](String.prototype.charCodeAt.call(t,0))))).join(""))).join(""),g={url:t=>[encodeURIComponent(t)],html:t=>[[...t].map((t=>d(t,"html"))).join(""),[...t].map((t=>(t=>s(p,t)?p[t]:t)(t))).join("")],js:t=>[[...t].map((t=>c(t))).join(""),[...t].map((t=>d(t,"js"))).join("")],json:t=>[[...t].map((t=>c(t))).join(""),[...t].map((t=>d(t,"js"))).join("")]},h=(t,e)=>{const o=new Set;for(const r in e)Object.prototype.hasOwnProperty.call(g,r)&&g[r](t).forEach((t=>o.add(t)));return Array.from(o)},m=t=>({startStopPairs:o(t.startStopPairs,["${","}"],"Invalid startStopPairs"),escapeSep:void 0!==t.escapeSep&&t.escapeSep,allowUnquotedProps:!!t.allowUnquotedProps,allowRootBracket:!!t.allowRootBracket,sanitizer:t.sanitizer||(t=>!0===t.isEmpty?"undefined":String(t.value)),maxNameLength:t.maxNameLength||256}),y=h,x=t=>{const[e,o,r,n,s,a]=[".","[","]",'"',"'","`"].map((e=>t?h(e,t):[e]));return{per:e,opBracket:o,clBracket:r,quote:n,apostrophe:s,backtick:a}},b=(t,e,o)=>{const s=n(o)?o:{},a=m(s),{startStopPairs:l,escapeSep:c,maxNameLength:p}=a,f=l.filter((e=>t.includes(e[0])&&t.includes(e[1]))).map((t=>[r(t[0]),r(t[1])])).map((([t,e])=>`(?:${t}\\s*([\\s\\S]{0,${p}}?)\\s*${e})`)),u=new Map,d=RegExp(f.join("|"),"g"),g=()=>{d.lastIndex=0},h=()=>d.exec(t);for(const t of function(t,e,o){return{[Symbol.iterator]:()=>({next(){const r=t(...e);return r?{done:!1,value:r}:(o&&o(),{done:!0,value:void 0})}})}}(h,[],g))if(null!==t){const{index:e}=t,[o,r]=t.filter((t=>"string"==typeof t));if(!o&&!d.lastIndex)break;if(u.has(o)){const t=u.get(o);t&&t.indexes.push(e)}else u.set(o,{content:r,indexes:[e]})}const y=new i(e);let b=0;const j=[...t],k=x(c);for(const[t,e]of u){Object.prototype.hasOwnProperty.call(e,"value")||(e.value=y.getContextVal(e,k,a));for(const o of e.indexes){const r=String(e.value||"");j.splice(o+b,t.length,...r),b+=r.length-t.length}}return j.join("")};exports.createEscapes=y,exports.default=b,exports.getDefaultOptions=m,exports.getSeparators=x,exports.subslate=b;
//# sourceMappingURL=subslate.cjs.map
