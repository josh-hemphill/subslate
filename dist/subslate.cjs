"use strict";function t(t,e,o){return{[Symbol.iterator]:()=>({next(){const r=t(...e);return r?{done:!1,value:r}:(o&&o(),{done:!0,value:void 0})}})}}Object.defineProperty(exports,"__esModule",{value:!0});const e=t=>Array.isArray(t)&&t.length>0,o=t=>e(t)&&2===t.length&&t.every((t=>"string"==typeof t)),r=(t,r,n="Missing Provided Input")=>{if(void 0===t)return[r];if("string"==typeof t)return[[t,t]];if(o(t))return[t];if((t=>e(t)&&t.every((t=>o(t))))(t))return t;throw Error(n)};function n(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}const s=Symbol("Blank Value");class a{constructor(t){this.context=t}getContextVal(t,e,o){const r=t.content,a=this.context,{allowRootBracket:i,allowUnquotedProps:l,sanitizer:c}=o,{per:p,opBrac:f,clBrac:u,quote:d,apos:g,backt:m}=e,h=[d,g,m].flat().filter((t=>r.includes(t))).map((t=>n(t)));function x(t,e,o=0){let a=s,c=0;const d=Object.keys(e);t:{if(0===o)for(const r of d)if(t.startsWith(r,o)){a=e[r],c=r.length;break t}if(0!==o)for(const r of p)if(t.startsWith(r,o))for(const n of d)if(t.startsWith(r+n,o)){a=e[n],c=r.length+n.length;break t}if(0!==o||i){const s=f.map(((t,e)=>[t,u[e]])).filter((e=>t.includes(e[0])&&t.includes(e[1])));let i=null;for(const[e,r]of s)if(t.startsWith(e,o)){i=[e,r];break}if(null===i)break t;const[p,g]=i.map((t=>n(t)));for(const t of[...h,...l?[""]:[]])for(const s of d){const i=n(s),l=RegExp(`^[\\s\\S]{${o}}(${p}s*${t}(${i})${t}s*${g})`);l.lastIndex=o;const f=l.exec(r);if(f&&f[2]){a=e[s],c=f[1].length;break t}}}}return[a,c]}let y=s,b=0;for(;b<r.length;){const t=y===s?a:y;if("object"!=typeof t)break;const[e,o]=x(r,t,b);if(0===o)break;b+=o,y=e}if(y=c(y===s?{isEmpty:!0,id:r,at:b}:{isEmpty:!1,value:y,id:r}),"string"!=typeof y)throw Error("Sanitizer did not provide string");return y}}const i={"'":"'",'"':'"',"\\":"\\","`":"`","[":"[","]":"]"},l=t=>i[t]||t,c={".":["&period;"],"\\":["&#x27;"],"'":["&apos;"],'"':["&quot;"],"[":["&lsqb;"],"]":["&rsqb;"]},p=t=>`\\u${Number.prototype.toString.call(t,16).toUpperCase()}`,f=t=>`&#x${Number.prototype.toString.call(t,16).toUpperCase()};`,u=(t,e)=>[...t].map((t=>t.split("").map((t=>({js:p,html:f}[e](String.prototype.charCodeAt.call(t,0))))).join(""))).join(""),d={url:t=>[encodeURIComponent(t)],html:t=>[[...t].map((t=>u(t,"html"))).join(""),[...t].map((t=>(t=>c[t]||t)(t))).join("")],js:t=>[[...t].map((t=>l(t))).join(""),[...t].map((t=>u(t,"js"))).join("")],json:t=>[[...t].map((t=>l(t))).join(""),[...t].map((t=>u(t,"js"))).join("")]},g=(t,e)=>{const o=new Set;for(let r in e)d[r]&&d[r](t).forEach((t=>o.add(t)));return Array.from(o)},m=t=>({startStopPairs:r(t.startStopPairs,["${","}"],"Invalid startStopPairs"),escapeSep:t.escapeSep,allowUnquotedProps:!!t.allowUnquotedProps,allowRootBracket:!!t.allowRootBracket,sanitizer:t.sanitizer||(t=>!0===t.isEmpty?"undefined":String(t.value)),maxNameLength:t.maxNameLength||256}),h=g,x=t=>{const[e,o,r,n,s,a]=[".","[","]",'"',"'","`"].map((e=>t?g(e,t):[e]));return{per:e,opBrac:o,clBrac:r,quote:n,apos:s,backt:a}},y=(e,o,r)=>{const s=m(r),{startStopPairs:i,escapeSep:l,maxNameLength:c}=s,p=i.filter((t=>e.includes(t[0])&&e.includes(t[1]))).map((t=>[n(t[0]),n(t[1])])),f=new Map;for(const[o,r]of p){const n=RegExp(`${o}s*([\\s\\S]{0,${c}}?)s*${r}`,"g"),s=()=>{n.lastIndex=0},a=()=>n.exec(e);for(const{index:e,0:o,1:r}of t(a,[],s))if(f.has(o)){f.get(o).indexes.push(e)}else f.set(o,{content:r,indexes:[e]})}const u=new a(o);let d=0;const g=[...e],h=x(l);for(const[t,e]of f){e.hasOwnProperty("value")||(e.value=u.getContextVal(e,h,s));for(const o of e.indexes)g.splice(o+d,t.length,...e.value),d+=e.value.length-t.length}return g.join("")};exports.createEscapes=h,exports.default=y,exports.getDefaultOptions=m,exports.getSeparators=x,exports.subslate=y;
//# sourceMappingURL=subslate.cjs.map
