function t(t,e,o){return{[Symbol.iterator]:()=>({next(){const n=t(...e);return n?{done:!1,value:n}:(o&&o(),{done:!0,value:void 0})}})}}const e=t=>Array.isArray(t)&&t.length>0,o=t=>e(t)&&2===t.length&&t.every((t=>"string"==typeof t)),n=(t,n,r="Missing Provided Input")=>{if(void 0===t)return[n];if("string"==typeof t)return[[t,t]];if(o(t))return[t];if((t=>e(t)&&t.every((t=>o(t))))(t))return t;throw Error(r)};function r(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}const s=Symbol("Blank Value");class a{constructor(t){this.context=t}getContextVal(t,e,o){const n=t.content,a=this.context,{allowRootBracket:i,allowUnquotedProps:l,sanitizer:c}=o,{per:p,opBrac:f,clBrac:u,quote:d,apos:m,backt:g}=e,h=[d,m,g].flat().filter((t=>n.includes(t))).map((t=>r(t)));function x(t,e,o=0){let a=s,c=0;const d=Object.keys(e);t:{if(0===o)for(const n of d)if(t.startsWith(n,o)){a=e[n],c=n.length;break t}if(0!==o)for(const n of p)if(t.startsWith(n,o))for(const r of d)if(t.startsWith(n+r,o)){a=e[r],c=n.length+r.length;break t}if(0!==o||i){const s=f.map(((t,e)=>[t,u[e]])).filter((e=>t.includes(e[0])&&t.includes(e[1])));let i=null;for(const[e,n]of s)if(t.startsWith(e,o)){i=[e,n];break}if(null===i)break t;const[p,m]=i.map((t=>r(t)));for(const t of[...h,...l?[""]:[]])for(const s of d){const i=r(s),l=RegExp(`^[\\s\\S]{${o}}(${p}s*${t}(${i})${t}s*${m})`);l.lastIndex=o;const f=l.exec(n);if(f&&f[2]){a=e[s],c=f[1].length;break t}}}}return[a,c]}let y=s,b=0;for(;b<n.length;){const t=y===s?a:y;if("object"!=typeof t)break;const[e,o]=x(n,t,b);if(0===o)break;b+=o,y=e}if(y=c(y===s?{isEmpty:!0,id:n,at:b}:{isEmpty:!1,value:y,id:n}),"string"!=typeof y)throw Error("Sanitizer did not provide string");return y}}const i={"'":"'",'"':'"',"\\":"\\","`":"`","[":"[","]":"]"},l=t=>i[t]||t,c={".":["&period;"],"\\":["&#x27;"],"'":["&apos;"],'"':["&quot;"],"[":["&lsqb;"],"]":["&rsqb;"]},p=t=>`\\u${Number.prototype.toString.call(t,16).toUpperCase()}`,f=t=>`&#x${Number.prototype.toString.call(t,16).toUpperCase()};`,u=(t,e)=>[...t].map((t=>t.split("").map((t=>({js:p,html:f}[e](String.prototype.charCodeAt.call(t,0))))).join(""))).join(""),d={url:t=>[encodeURIComponent(t)],html:t=>[[...t].map((t=>u(t,"html"))).join(""),[...t].map((t=>(t=>c[t]||t)(t))).join("")],js:t=>[[...t].map((t=>l(t))).join(""),[...t].map((t=>u(t,"js"))).join("")],json:t=>[[...t].map((t=>l(t))).join(""),[...t].map((t=>u(t,"js"))).join("")]},m=(t,e)=>{const o=new Set;for(let n in e)d[n]&&d[n](t).forEach((t=>o.add(t)));return Array.from(o)},g=t=>({startStopPairs:n(t.startStopPairs,["${","}"],"Invalid startStopPairs"),escapeSep:t.escapeSep,allowUnquotedProps:!!t.allowUnquotedProps,allowRootBracket:!!t.allowRootBracket,sanitizer:t.sanitizer||(t=>!0===t.isEmpty?"undefined":String(t.value)),maxNameLength:t.maxNameLength||256}),h=m,x=t=>{const[e,o,n,r,s,a]=[".","[","]",'"',"'","`"].map((e=>t?m(e,t):[e]));return{per:e,opBrac:o,clBrac:n,quote:r,apos:s,backt:a}},y=(e,o,n)=>{const s=g(n),{startStopPairs:i,escapeSep:l,maxNameLength:c}=s,p=i.filter((t=>e.includes(t[0])&&e.includes(t[1]))).map((t=>[r(t[0]),r(t[1])])),f=new Map;for(const[o,n]of p){const r=RegExp(`${o}s*([\\s\\S]{0,${c}}?)s*${n}`,"g"),s=()=>{r.lastIndex=0},a=()=>r.exec(e);for(const{index:e,0:o,1:n}of t(a,[],s))if(f.has(o)){f.get(o).indexes.push(e)}else f.set(o,{content:n,indexes:[e]})}const u=new a(o);let d=0;const m=[...e],h=x(l);for(const[t,e]of f){e.hasOwnProperty("value")||(e.value=u.getContextVal(e,h,s));for(const o of e.indexes)m.splice(o+d,t.length,...e.value),d+=e.value.length-t.length}return m.join("")};export default y;export{h as createEscapes,g as getDefaultOptions,x as getSeparators,y as subslate};
//# sourceMappingURL=subslate.poly.esm.js.map
